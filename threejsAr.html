<!DOCTYPE html>
<html>
<head>
    <title>AR.js with Three.js Example</title>
    <!--<script src="https://cdn.rawgit.com/jeromeetienne/ar.js/master/aframe/build/aframe-ar.min.js"></script>-->
</head>
<body style="margin: 0; overflow: hidden;">
    <button id="start-ar" style="position: absolute; z-index: 100; top: 10px;">Start AR</button>
    <div id="model-container" style="width: 100%; height: 100vh;"></div>
    <a-scene id="ar-scene" embedded arjs="sourceType: webcam; debugUIEnabled: false;" style="display: none;">
        <a-marker preset='hiro'>
            <a-entity id="ar-model" position='0 0 0' rotation="0 0 0" scale="0.5 0.5 0.5"></a-entity>
        </a-marker>
        <a-entity camera></a-entity>
    </a-scene>
   	<script type="importmap">
			{
				"imports": {
					"three": "./build/three.module.js",
					"three/addons/": "./jsm/"
				}
			}
		</script>

	<script type="module">

		import * as THREE from 'three';
		import { ARButton } from 'three/addons/webxr/ARButton.js';

		import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
		import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
		 //import { ARButton } from 'three/addons/webxr/ARButton.js'
		
        let scene, camera, renderer, controls, model;

        function initThreeJS() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 5;

            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.getElementById('model-container').appendChild(renderer.domElement);

            controls = new OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.25;
            controls.enableZoom = true;

            let ambientLight = new THREE.AmbientLight(0xcccccc, 1);
            scene.add(ambientLight);

            let directionalLight = new THREE.DirectionalLight(0xffffff, 1);
            directionalLight.position.set(5, 5, 5).normalize();
            scene.add(directionalLight);

            let loader = new GLTFLoader();
            loader.load('3d/car.glb', function (gltf) {
                model = gltf.scene;
				
				model.traverse((child) => {
							if (child.isMesh && child.material.name === 'M4xNME_GlassClear') {
								child.material.transparent = true;
								child.material.opacity = 0.3;
								child.material.blending = THREE.NormalBlending;
							}
						});
						
						model.scale.set(0.8, 0.8, 0.8);
                scene.add(model);
            });

            animate();
			document.body.appendChild(ARButton.createButton(renderer));
        }

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }

        /*function startAR() {
            document.getElementById('ar-scene').style.display = 'block';
            document.getElementById('start-ar').style.display = 'none';
            let arLoader = new GLTFLoader();
            arLoader.load('3d/car.glb', function (gltf) {
                let arModel = gltf.scene;
                document.getElementById('ar-model').setObject3D('mesh', arModel);
            });
        }*/
 function startAR() {
            document.getElementById('ar-scene').style.display = 'block';
            document.getElementById('start-ar').style.display = 'none';
        }


        document.getElementById('start-ar').onclick = startAR;

        window.onload = initThreeJS;
    </script>
</body>
</html>
